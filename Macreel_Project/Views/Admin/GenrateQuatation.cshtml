@{
    ViewBag.Title = "GenrateQuatation";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/css/fSelect.css" rel="stylesheet" />
<style>
    * {
        box-sizing: border-box;
    }

    .Description {
        transition: transform .2s;
        margin: 0 auto;
    }

        .Description:hover {
            -ms-transform: scale(1.9); /* IE 9 */
            -webkit-transform: scale(1.9); /* Safari 3-8 */
            transform: scale(1.9);
        }

    .col-form-label {
        font-size: 10px;
        font-weight: 500;
    }

    .h5 {
        text-align: center;
        background-color: #1d3c60;
        color: white;
    }

    .font {
        font-size: 11px;
        font-weight: 700 !important;
        background: #08638e;
        color: #fff;
    }

    .edit-box h5 {
        font-size: 19px;
        text-align: center;
    }

    .edit-box {
        padding: 25px 0px;
    }

    .col-form-label {
        font-size: 10px;
        font-weight: 500;
    }

    .h5 {
        text-align: center;
        background-color: #1d3c60;
        color: white;
    }

    .head-title th {
        font-size: !important;
        font-size: 14px !important;
        color: #fff;
        padding: 6px !IMPORTANT;
        font-weight: 700 !IMPORTANT;
    }

    .bg-info {
        background-color: #08638e !important;
        /* padding: 6px !IMPORTANT; */
    }

    .table-bg {
        border: 1px solid #08638e;
        margin-bottom: 30px;
    }

    .processing {
        position: fixed;
        z-index: 10000;
        height: 100%;
        width: 100%;
        top: 0;
        left: 0;
        background-color: Black;
        filter: alpha(opacity=60);
        opacity: 0.6;
        -moz-opacity: 0.8;
    }

    .center {
        z-index: 10000;
        margin: 300px auto;
        padding: 10px;
        width: 130px;
        background-color: White;
        border-radius: 10px;
        filter: alpha(opacity=100);
        opacity: 1;
        -moz-opacity: 1;
    }

    .sn-error {
        border-color: red;
    }

    .fs-wrap {
        display: inline-block;
        cursor: pointer;
        line-height: 1;
        width: 100%;
    }

    .fs-label-wrap .fs-label {
        padding: 10px 18px;
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
    }

    .fs-dropdown {
        position: absolute;
        background-color: #fff;
        border: 1px solid #8a8a8a;
        width: 100%;
        margin-top: 5px;
        z-index: 1000;
    }

    .btn-primary {
        background-color: rgba(44,169,145,1) !important;
        border-color: rgba(44,169,145,1) !important;
        color: #fff !important;
        box-shadow: none !important;
    }

    .popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #f9f9f9;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        z-index: 1000;
    }

        .popup h2 {
            margin-top: 0;
        }

        .popup input[type="text"],
        .popup input[type="date"],
        .popup button {
            margin-bottom: 10px;
        }

    /* .popup button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
        }*/

    /* .popup button:hover {
                background-color: #45a049;
            }*/
</style>
<!--div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-12">
                <h1 class="m-0">GENERATE QUATATION</h1>
            </div>-->
<!-- /.col -->
<!-- /.col -->
<!--</div>--><!-- /.row -->
<!--</div>--><!-- /.container-fluid -->
<!--</div>-->
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<div class="processing" style="display: none">
    <div class="center">
        <span style="color:red;"><i style="font-size:14pt; font-weight:bold; opacity:1!important; margin-top:4px;" class="fa fa-spin fa-spinner"></i> Processing...</span>
    </div>
</div>
<div class="panel-header panel-header-sm">
</div>
<div class="content">
    <div class="row">
        <div class="col-md-12">
            <form id="TypeValidation" class="form-horizontal">
                <div class="card ">

                    <div class="card-body ">
                        <div class="row">
                            <div class="col-md-2">
                                <label for="quatation">Company Name<div class="badge badge-pill badge-success ml-auto px-1 py-1"><i class="sn-Pluse  mdi mdi-plus font-weight-bold fa fa-plus" style="cursor:pointer"></i></div></label>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <select id="CompanyName" class="form-control sn-required" required>
                                        <option value="">--Select Client--</option>
                                        @if (ViewBag.client != null)
                                        {
                                            foreach (var item in ViewBag.client as List<SelectListItem>)
                                            {
                                                if (Model.CompanyId == item.Value)
                                                {
                                                    <option selected value="@item.Value">@item.Text</option>
                                                }
                                                else
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }

                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-0">
                                <label class="services">Services</label>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <select id="Services" class="form-control sn-required" @*multiple="multiple"*@ required>
                                        <option value="">Select Services</option>
                                        @if (ViewBag.service != null)
                                        {
                                            foreach (var item in ViewBag.service as List<SelectListItem>)
                                            {
                                                <option value="@item.Value">@item.Text</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div id="Clients" style="display:none;">
                            <h6 style="text-align:center;">
                                Company Detail
                            </h6>
                            <div class="row">
                                <div class="col-md-12 ">
                                    <div class="table-bg">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead style="line-height: normal; height: 1px !important;">
                                                    <tr style="background-color: rgba(22,160,133,0.9); color: white;">
                                                        <th style="padding:5px;">
                                                            Company Name
                                                        </th>
                                                        <th style="padding:5px;">
                                                            Contact Person
                                                        </th>
                                                        <th style="padding:5px;">
                                                            Mobile
                                                        </th>

                                                        <th style="padding:5px;">
                                                            Email Id
                                                        </th>
                                                        <th style="padding:5px;">
                                                            State Name
                                                        </th>
                                                        <th style="padding:5px;">
                                                            City Name
                                                        </th>
                                                        <th style="padding:5px;">
                                                            GSTN
                                                        </th>

                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td><span id="Company"></span>  </td>
                                                        <td><span id="ContectPerson"></span></td>
                                                        <td><span id="Mobile"></span></td>
                                                        <td><span id="EmailId"></span></td>
                                                        <td><span id="StateName"></span></td>
                                                        <td><span id="CityName"></span></td>
                                                        <td><span id="Gst"></span></td>
                                                    </tr>

                                                </tbody>
                                            </table>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="display:none;" id="tblIndentFilesH1">
                            <h6 style="text-align:center;">
                                Product Details
                            </h6>
                            <table id="tblIndentFilesH" class="cell-border table" cellspacing="1" border="1" style="border:1px solid #dddddd; width:100%;">
                                <thead style="line-height: normal; height: 1px !important;">
                                    <tr style="background-color: rgba(22,160,133,0.9); color: white;">
                                        <th style="padding:5px;">
                                            Product Name
                                        </th>
                                        <th style="padding:5px;">
                                            Unit Price
                                        </th>
                                        <th style="padding:5px;">
                                            Quantity
                                        </th>

                                        <th style="padding:5px;">
                                            Total
                                        </th>
                                        <th style="padding:5px;">
                                            Naration
                                        </th>
                                        <th style="padding:5px;">
                                            AMC
                                        </th>
                                        <th style="padding:5px;">
                                            Renewable
                                        </th>
                                        <th style="padding:5px;">
                                            Action
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="tblIndentFilesBody">
                                    <tr class='selectWrapper'>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th colspan="8" class="text-right">
                                            <a id="LnkAddFileRowH" style="margin: 10px 15px;" class="btn btn-info btn-sm  badge-success icon-btn ml-2 mb-2" title="Add More"><i class="mdi mdi-plus font-weight-bold fa fa-plus"></i></a>
                                        </th>
                                    </tr>
                                </tfoot>

                            </table>
                        </div>
                        <div style="padding:7px;">

                        </div>
                        <div class="row">

                            <div class="col-md-2">
                                <label class="total" id="totalLabel" style="display: none;">Total</label>
                            </div>
                            <div class="col-sm-2">
                                <div class="form-group">
                                    <input class="form-control sn-required" readonly id="Total" type="text" name="required" required style="display: none;" />
                                </div>
                            </div>
                            <input type="text" hidden class="form-control sn-required" id="Discount" value="0" />
                            <input type="text" hidden readonly class="form-control" id="DiscountAmount" name="required" required />

                            <input class="form-control sn-required" hidden readonly id="AfterDiscountAmount" type="text" name="required" required />
                            <input type="text" hidden value="0" />
                            <input type="text" hidden id="QuatationNo" value="@Model.QuatationNo" />

                        </div>
                        <div class="edit-box">
                            <div class="row">
                                <div class="col-sm-12">
                                    <h5> Scope Of Work</h5>
                                    <div class="form-group">
                                        <textarea class="form-control ckeditor" id="WorkScope" name="editor1" rows="5">@*@Html.Raw(@Model.QuestionName)*@</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer text-center">
                        @if (Model.Id != 0)
                        {
                            <button type="button" class="btn btn-primary" id="btnSave">Update</button>
                        }
                        else
                        {
                            <button type="button" class="btn btn-primary" id="btnSave">Genrate Quatation</button>
                        }

                    </div>
                </div>
                <div id="amcPopup" class="popup">
                    <h2 style="padding: 0px 50px">AMC Information</h2>
                    <hr />
                    <label for="amcAmount">AMC Amount:</label>
                    <input type="text" id="amcAmount" class="form-control AMCAmount" required><br>
                    <label for="amcStartDate">AMC Start Date:</label>
                    <input type="date" id="amcStartDate" class="form-control AMCStartDate" required><br><br>
                    @*<button type="submit" class="btn btn-primary">Submit</button>*@
                    <button id="amcPopupSubmit" class="btn btn-primary">Submit</button>
                    <button id="amcPopupClose" class="btn btn-danger">Close</button>
                </div>

                <div id="renewablePopup" class="popup">
                    <h2>Renewable Information</h2>
                    <hr />
                    <label for="renewableAMCAmount">Renewable Amount:</label>
                    <input type="text" id="renewableAMCAmount" class="form-control RenewableAmount" required><br>
                    <label for="renewableAMCStartDate">Renewable Start Date:</label>
                    <input type="date" id="renewableAMCStartDate" class="form-control RenewableStartDate" required><br><br>
                    <button id="rewPopupSubmit" class="btn btn-primary">Submit</button>
                    <button type="button" id="rewPopupClose" class="btn btn-danger">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="~/scripts/jquery-3.4.1.min.js"></script>
<script src="~/Content/js/fSelect.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" defer></script>
<script src="~/scripts/alert.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.ckeditor.com/4.16.1/standard/ckeditor.js"></script>
<script>
    $(document).ready(function () {
        // Hide the table initially
        $('#tblIndentFilesH1').hide();

        // Event handler for plus icon click in the footer
        $('#LnkAddFileRowH').click(function (e) {
            e.preventDefault();
            // Show the table when a new row is added
            $('#tblIndentFilesH1').show();
            // Add a new row to the table
            addNewRowToTable();
            /*  totalOfEachRowForHardware();*/

        });
        // Event handler for plus icon click
        $('i.sn-Pluse').click(function () {
            var me = $(this);
            var Id = me.attr('UserId');
            $('#modal-primary').modal({ backdrop: 'static', keyboard: true });
            // Add a new row to the table when plus icon is clicked
            addNewRowToTable();
            /*  totalOfEachRowForHardware();*/
        });

        $('i.sn-pro').click(function () {
            var me = $(this);
            var Id = me.attr('UserId');
            $('#modal-primary1').modal({ backdrop: 'static', keyboard: true });
        });

        $('#Services').change(function (e) {
            e.preventDefault();
            var selectedService = $(this).val();
            if (selectedService !== "") {
                // Show the total label and input
                $('#totalLabel').show();
                $('#Total').show();
                // Show the table when a service is selected
                $('#tblIndentFilesH1').show();
                /*addNewRowToTable();*/
            } else {
                // Hide the total label and input if no service is selected
                $('#totalLabel').hide();
                $('#Total').hide();
                // Hide the table if no service is selected
                $('#tblIndentFilesH1').hide();
            }
        });

        $('#CompanyName').change(function () {
            var me = $(this);
            $.ajaxSetup({
                beforeSend: function () {
                    $(".processing").show();
                    me.attr('disabled', 'disabled');
                },
                complete: function () {
                    $(".processing").hide();
                    me.attr('disabled', false);
                }
            });
            var ClientId = {
                ClientId: $(this).val()
            }
            $.ajax({
                type: "POST",
                url: "/Admin/GetCompanyDetail",
                data: JSON.stringify(ClientId),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (resultData) {
                    if (resultData != null) {
                        $('#Company').text(resultData.CompanyName);
                        $('#ContectPerson').text(resultData.ContactPerson);
                        $('#Mobile').text(resultData.ContactNo);
                        $('#Gst').text(resultData.GSTNo);
                        $('#EmailId').text(resultData.EmailId);
                        $('#StateName').text(resultData.StateName);
                        $('#CityName').text(resultData.CityName);
                        $("#ClientName").val(resultData.ContactPerson);
                        $("#Clients").show();
                    }
                }
            });
        });

        $('#CompanyName').change(function () {
            $.ajax({
                url: '/Admin/BindProjectForQuatation',
                datatype: 'json',
                data: { CompanyId: $(this).val() },
                method: 'Post',
                success: function (data) {
                    $('#ProjectName').empty();
                    $('#ProjectName').append('<option value="">Select Project</option>');
                    $(data).each(function (index, item) {
                        $('#ProjectName').append($('<option/>', { Value: item.Value, text: item.Text }))
                    });
                }
            })
        });

        $('#Discount').change(function () {
            var me = $(this);
            //$.ajaxSetup({
            //    beforeSend: function () {
            //        $(".processing").show();
            //        me.attr('disabled', 'disabled');
            //    },
            //    complete: function () {
            //        $(".processing").hide();
            //        me.attr('disabled', false);
            //    }
            //});
            var Discount = {
                Discount: $(this).val(),
                Amount: $("#Total").val()
            }
            $.ajax({
                type: "POST",
                url: "/Admin/DiscountPercentage",
                data: JSON.stringify(Discount),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (resultData) {
                    if (resultData != null) {
                        $('#DiscountAmount').val(resultData);
                        var totalwithtax = parseFloat($('#Total').val()) - parseFloat($('#DiscountAmount').val());
                        $("#AfterDiscountAmount").val(totalwithtax.toFixed(2)).val();
                    }
                }
            });
        });

        $(function () {
            $(".datepicker").datepicker({
                dateFormat: 'mm-dd-yy',
                changeMonth: true,
                changeYear: true,
                yearRange: "c-100:c+100",
            });
        });
    });

    function addNewRowToTable() {
        var NewRow = '<tr class="selectWrapper">';
        NewRow += '<td><input type="text" class="form-control ProductName" value="" placeholder="ProductName"></td>';
        NewRow += '<td><input type="text" class="form-control Amounts" value="" placeholder="Amount"></td>';
        NewRow += '<td><input type="text" class="form-control Unit" value="" placeholder="Quantity"></td>';
        NewRow += '<td><input type="text" class="form-control Amount" value="" readonly placeholder="Total Amount"></td>';
        NewRow += '<td><textarea class="form-control-sm Description" placeholder="Naration" rows="2" style="width:100%;"></textarea></td>';
        NewRow += '<td><select class="form-control AMC"><option value="">Select</option><option value="Yes">Yes</option><option value="No">No</option></select><input type="hidden" class="form-control AMC_amount" readonly><input type="hidden" class="form-control AMC_date" readonly></td>';
        NewRow += '<td><select class="form-control Renewable"><option value="">Select</option><option value="Yes">Yes</option><option value="No">No</option></select><input type="hidden" class="form-control REWAmount" readonly><input type="hidden" class="form-control REW_date" readonly></td>';
        NewRow += '<td><a class="btn btn-danger btn-sm icon-btn ml-2 LnkDeleteFileRow" title="Remove" style="padding:2px;"><i class="mdi mdi-delete fa fa-trash sn-delete"></i></a></td>';
        NewRow += '</tr>';

        $('#tblIndentFilesH tbody').append(NewRow);
        implementDeleteFileRowForH();
        rebindLastSelectBox();
    }

    // Function to handle deletion of row
    function implementDeleteFileRowForH() {
        $("#tblIndentFilesH tbody tr .LnkDeleteFileRow").click(function (e) {
            e.preventDefault();
            var CurrRow = $(this).closest("tr");
            CurrRow.remove();
            totalOfEachRowForHardware();
        });
    }
    //$('#tblIndentFilesH').on('change', ' input.Unit', function () {
    //    totalOfEachRowForHardware();
    //});
    function rebindLastSelectBox() {
        $('input.Unit').change(function () {
            $(this).unbind('change');
            $.ajaxSetup({
                beforeSend: function () {
                    $(".processing").show();
                },
                complete: function () {
                    $(".processing").hide();
                }
            });
            var currentRow = $(this).closest("tr");
            var unit = currentRow.find("input.Unit").val();
            var Price = parseFloat(currentRow.find("input.Amounts").val());
            var Product = {
                Price: Price,
                Unit: unit,
            };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: Product,
                url: "/Admin/TotalAmountOfProduct",
                Contenttype: "application/json; charset=utf-8",
                success: function (resultData) {
                    currentRow.find('input.Amount').val(resultData.toFixed(2));
                    totalOfEachRowForHardware();
                }
            });
            rebindLastSelectBox();
        })

        $('input.Amounts').change(function () {
            /* $(this).unbind('change');*/
            //$.ajaxSetup({
            //    beforeSend: function () {
            //        $(".processing").show();
            //    },
            //    complete: function () {
            //        $(".processing").hide();
            //    }
            //});
            var currentRow = $(this).closest("tr");
            var unit = currentRow.find("input.Unit").val();
            var Price = parseFloat(currentRow.find("input.Amounts").val());
            var Product = {
                Price: Price,
                Unit: unit,
            };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: Product,
                url: "/Admin/TotalAmountOfProduct",
                Contenttype: "application/json; charset=utf-8",
                success: function (resultData) {
                    currentRow.find('input.Amount').val(resultData.toFixed(2));
                    totalOfEachRowForHardware();
                }
            });
            rebindLastSelectBox();
        })
    }

    function totalOfEachRowForHardware() {
        var sum = 0;
        $('#tblIndentFilesH .Amount').each(function () {
            if (!isNaN(this.value) && this.value.length != 0) {
                sum += parseFloat(this.value);
            }
        });

        var totalAmount = parseFloat(sum).toFixed(2);
        $('#Total').val(totalAmount);
        $('#AfterDiscountAmount').val(totalAmount);
    }
</script>

<script>
    $(document).ready(function () {
        // Hide the AMC popup initially
        $('#amcPopup').hide();

        // Event delegation for AMC dropdown change
        $('#tblIndentFilesH1').on('change', 'select.AMC', function () {
            var selectedOption = $(this).val();
            var currentRow = $(this).closest("tr");
            if (selectedOption === "Yes") {
                // Open the AMC popup for the current row
                $('#amcPopup').data('currentRow', currentRow);
                $('#amcPopup').show();
            } else {
                // If "No" is selected, hide the AMC details fields and popup for the current row
                currentRow.find('.AMC_amount').val('');
                currentRow.find('.AMC_date').val('');
                $('#amcPopup').hide();
            }
        });

        // Event handler for submitting AMC details
        $('#amcPopupSubmit').click(function () {
            var currentRow = $('#amcPopup').data('currentRow');
            var amcAmountInput = currentRow.find('.AMC_amount');
            var amcDateInput = currentRow.find('.AMC_date');
            var amcAmount = $('#amcAmount').val();
            var amcStartDate = $('#amcStartDate').val();
            amcAmountInput.val(amcAmount);
            amcDateInput.val(amcStartDate);
            $('#amcPopup').hide();
            document.getElementById("amcAmount").value = "";
            document.getElementById("amcStartDate").value = "";
        });

        // Event handler for closing the AMC popup
        $('#amcPopupClose').click(function () {
            $('#amcPopup').hide();
        });



        $('#renewablePopup').hide();

        // Event delegation for Renewable dropdown change
        $('#tblIndentFilesH1').on('change', 'select.Renewable', function () {
            var selectedOption = $(this).val();
            var currentRow = $(this).closest("tr");
            if (selectedOption === "Yes") {
                // Open the renewable popup for the current row
                $('#renewablePopup').data('currentRow', currentRow);
                $('#renewablePopup').show();
            } else {
                // If "No" is selected, hide the renewable details fields and popup for the current row
                currentRow.find('.REWAmount').val('');
                currentRow.find('.REW_date').val('');
                $('#renewablePopup').hide();
            }
        });
        // Event handler for submitting renewable details
        $('#rewPopupSubmit').click(function () {
            var currentRow = $('#renewablePopup').data('currentRow');
            var renewableAmountInput = currentRow.find('.REWAmount');
            var renewableDateInput = currentRow.find('.REW_date');
            var renewableAmount = $('#renewableAMCAmount').val();
            var renewableStartDate = $('#renewableAMCStartDate').val();
            renewableAmountInput.val(renewableAmount);
            renewableDateInput.val(renewableStartDate);
            $('#renewablePopup').hide();
            document.getElementById("renewableAMCAmount").value = "";
            document.getElementById("renewableAMCStartDate").value = "";
        });
        // Event handler for closing the renewable popup
        $('#rewPopupClose').click(function () {
            $('#renewablePopup').hide();
        });
    });
</script>

<script>
    $(document).ready(function () {
        $("#btnSave").click(function () {
            $.ajaxSetup({
                beforeSend: function () {
                    $(".processing").show();
                },
                complete: function () {
                    $(".processing").hide();
                }
            });
            var flag = 0;
            var cntrl;
            $('input.sn-required,select.sn-required,textarea.sn-required').each(function () {
                cntrl = $(this);
                if (cntrl.val().toString().length == 0) {
                    flag = 1;
                    if (!cntrl.hasClass('sn-error'))
                        cntrl.removeClass('border-success');
                    cntrl.addClass('sn-error');
                    swal.fire({
                        title: "Error",
                        text: "Something is missing",
                        icon: "error",
                        timer: 6000,
                    });
                } else {
                    if (cntrl.hasClass('sn-error')) cntrl.removeClass('sn-error');
                }
            });
            if (flag == 1) return;

            // Populate AMC popup data

            var WorkScope = CKEDITOR.instances["WorkScope"].getData();
            var Services = $('#Services').val();;
            var TotalAmount = $('#Total').val();
            var DiscountQty = $('#Discount').val();
            var DiscountAmount = $('#DiscountAmount').val();
            var AfterDiscountAmount = $('#AfterDiscountAmount').val();
            var CompanyId = $('#CompanyName').val();
            var CompanyName = $('#CompanyName').find("option:selected").text();
            var ProjectName = $('#ProjectName').val();
            var QuatationNo = $('#QuatationNo').val();
            var ProjectAmount = $('#ProjectAmount').val();

            console.log("Services:", Services);
            var HSNNo = [];
            var HardWareName = [];
            var HAmount = [];
            var HUnit = [];
            var HTotal = [];
            var HDescription = [];
            var AMC = [];
            var AMCamount = [];
            var AMCdate = [];
            var Renewable = [];
            var REWamount = [];
            var REWdate = [];
            $('table#tblIndentFilesH > tbody > tr').each(function () {
                HardWareName.push($('td input[type="text"].ProductName', this).val());
                HAmount.push($('td input[type="text"].Amounts', this).val());
                HUnit.push($('td input[type="text"].Unit', this).val());
                HTotal.push($('td input[type="text"].Amount', this).val());
                HDescription.push($('td textarea.Description', this).val());
                AMC.push($('td select.AMC', this).val());
                AMCamount.push($('td input[type="hidden"].AMC_amount', this).val());
                AMCdate.push($('td input[type="hidden"].AMC_date', this).val());
                Renewable.push($('td select.Renewable', this).val());
                REWamount.push($('td input[type="hidden"].REWAmount', this).val());
                REWdate.push($('td input[type="hidden"].REW_date', this).val());
            });
            var service = {
                ServicesId: Services,
                TotalAmount: TotalAmount,
                DiscountQty: DiscountQty,
                DiscountAmount: DiscountAmount,
                AfterDiscountAmount: AfterDiscountAmount,
                CompanyId: CompanyId,
                CompanyName: CompanyName,
                ProjectName: ProjectName,
                QuatationNo: QuatationNo,
                ProjectAmount: ProjectAmount,
                HardWareName: HardWareName,
                HSNNo: HSNNo,
                HAmount: HAmount,
                HUnit: HUnit,
                HTotal: HTotal,
                Naration: HDescription,
                AMC: AMC,
                AMCamount: AMCamount,
                AMCdate: AMCdate,
                Renewable: Renewable,
                REWamount: REWamount,
                REWdate: REWdate,
                WorkScope: WorkScope
            };
            try {
                $.ajax({
                    type: "POST",
                    url: "/Admin/INSERTGenrateQuatation",
                    data: JSON.stringify(service),
                    contentType: "application/json",
                    dataType: "json",
                    success: function (message) {
                        if (message == "success") {
                            swal.fire({
                                title: "Success",
                                text: "Successfully Added!",
                                icon: "success",
                                showCancelButton: false, // Hide the cancel button
                                confirmButtonText: "OK", // Customize the OK button text
                                confirmButtonColor: "#3085d6", // Custom color for the confirm button
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    window.location.href = "/Admin/GenrateQuatationList";
                                    Reset(); // Call Reset function if needed
                                }
                            });
                        }
                        else {
                            swal.fire({
                                title: "Error",
                                text: message,
                                icon: "error",
                                timer: 6000,
                            });
                        }
                        //if (resultData.split(',')[1] == "danger")
                        //    MsgBox(resultData.split(',')[0], resultData.split(',')[1]);
                        //else
                        //    MsgBoxRedirect(resultData.split(',')[0], resultData.split(',')[1], "/Admin/GenrateQuatationList");
                        //location.reload();
                    }
                });
            } catch (ex) {
                alert(ex.message);
            }
        });
    });

    function MsgBox(message, atype) {
        $.alert(message, { title: '', type: atype, autoClose: true, closeTime: 2000, minTop: 100 });
    }

    function MsgBoxRedirect(message, atype, location) {
        $.alert(message, {
            title: '', type: atype, autoClose: true, closeTime: 2000, minTop: 100, onClose: function () { window.location = location; }
        });
    }
</script>


<div id="modal-primary" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content" style="margin-left: -107px; width: 972px; border-color: rgba(22,160,133,0.9);">
            <div class="modal-header" style="background-color: rgba(22,160,133,0.9); color: white; height: 50px; padding: 15px;">

                <h4 class="modal-title">Add Company </h4><span id="Errer" style="color:red"></span>
                <button type="button" class="close" data-dismiss="modal" style="color: #fff6f7;opacity: inherit;">&times;</button>
            </div>
            <div class="content">
                <div class="row">
                    <div class="col-md-12">
                        <form id="TypeValidation" class="form-horizontal">
                            <div class="card ">

                                <div class="card-body ">
                                    <div class="row">

                                        <div class="col-md-2">
                                            <label for="company name">Company Name</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required1" id="CompanyName1" type="text" name="required" required />
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <label for="company name">Contect Person</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required1" id="ContactPerson1" type="text" name="required" required />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">

                                        <div class="col-md-2">
                                            <label for="company name">Contact No</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required1" id="ContactNo1" type="text" name="required" required="true" />
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <label for="company name">GST No</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required1" id="GSTNo1" type="text" name="required" required="true" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">

                                        <div class="col-md-2">
                                            <label for="company name">State</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <select id="State1" class="form-control sn-required1">
                                                    <option>--Select State--</option>
                                                    @if (ViewBag.STATE != null)
                                                    {
                                                        foreach (var item in ViewBag.STATE as List<SelectListItem>)
                                                        {

                                                            <option value="@item.Value">@item.Text</option>

                                                        }
                                                    }
                                                </select>

                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <label for="company name">City</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <select id="City1" class="form-control sn-required1">
                                                    <option>--Select City--</option>
                                                    @if (ViewBag.City != null)
                                                    {
                                                        foreach (var item in ViewBag.City as List<SelectListItem>)
                                                        {

                                                            <option value="@item.Value">@item.Text</option>

                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">

                                        <div class="col-md-2">
                                            <label for="company name">Address</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group sn-required1">
                                                <textarea style="width: 100%;" class="sn-required1" id="Address1"></textarea>
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <label for="company name">Statecode</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required1" id="Statecode1" type="text" name="required" required="true" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">

                                        <div class="col-md-2">
                                            <label for="company name">Pincode</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required1" id="Pincode1" type="text" name="required" required="true" />
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <label for="company name">Pan No</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required1" id="PanNo1" type="text" name="required" required="true" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">

                                        <div class="col-md-2">
                                            <label for="company name">E-mail Id</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required1" id="EmailId1" type="text" name="required" required="true" />
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <label for="company name">Designation</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required1" id="Designation1" type="text" name="required" required="true" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer text-center">

                                    <button type="button" class="btn btn-primary" id="btnSubmit1">Submit</button>

                                </div>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<div id="modal-primary1" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content" style="margin-left: -107px;width: 972px;border-color: #75ccce;">
            <div class="modal-header bg-primary" style="background:#115a5a;color: white;height: 50px;padding: 15px;">

                <h4 class="modal-title">Add Project </h4><span id="Errer" style="color:red"></span>
                <button type="button" class="close" data-dismiss="modal" style="color: #fff6f7;opacity: inherit;">&times;</button>
            </div>

            <div class="content">
                <div class="row">
                    <div class="col-md-12">
                        <form id="TypeValidation" class="form-horizontal">
                            <div class="card ">
                                <div class="card-header ">
                                    <h4 class="card-title">Add Project</h4>
                                </div>
                                <div class="card-body ">
                                    <div class="row">
                                        <label class="col-sm-2 col-form-label">Company Name</label>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <select id="CompanyName2" class="form-control sn-required2">
                                                    <option>--Select Client--</option>
                                                    @if (ViewBag.client != null)
                                                    {
                                                        foreach (var item in ViewBag.client as List<SelectListItem>)
                                                        {

                                                            <option value="@item.Value">@item.Text</option>

                                                        }
                                                    }
                                                </select>

                                            </div>
                                        </div>
                                        <label class="col-sm-2 col-form-label">Client Name</label>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required2" readonly id="ClientName2" type="text" name="required" required="true" />
                                            </div>
                                        </div>
                                    </div>
                                    <div id="Clients2" style="display:none;">
                                        <h4 style="text-align:center;">
                                            Company Detail
                                        </h4>
                                        <div class="row">
                                            <div class="col-md-12 ">
                                                <div class="table-bg">
                                                    <div class="table-responsive">
                                                        <table class="table">
                                                            <thead class="bg-info">
                                                                <tr class="head-title">
                                                                    <th>Comapny Name</th>
                                                                    <th>Contect Person</th>
                                                                    <th>Mobile</th>
                                                                    <th>Email-Id</th>
                                                                    <th>StateName</th>
                                                                    <th>CityName</th>
                                                                    <th>GSTN</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td><span id="Company2"></span>  </td>
                                                                    <td><span id="ContectPerson2"></span></td>
                                                                    <td><span id="Mobile2"></span></td>
                                                                    <td><span id="EmailId2"></span></td>
                                                                    <td><span id="StateName2"></span></td>
                                                                    <td><span id="CityName2"></span></td>
                                                                    <td><span id="Gst2"></span></td>
                                                                </tr>

                                                            </tbody>
                                                        </table>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 col-form-label">Project Name</label>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required2" id="ProjectName2" type="text" name="required" required="true" />
                                            </div>
                                        </div>

                                        <label class="col-sm-2 col-form-label">Project Starting Date</label>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required2 datepicker" id="ProjectStartingDate2" type="text" name="required" required="true" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">

                                        <label class="col-sm-2 col-form-label">Completion Date</label>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required2 datepicker" id="CompletionDate2" type="text" name="required" required="true" />
                                            </div>
                                        </div>
                                        <label class="col-sm-2 col-form-label">Project Delivery Date</label>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required2 datepicker" id="ProjectDeliveryDate2" type="text" name="required" required="true" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 col-form-label">Total Amount</label>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <input class="form-control sn-required2" id="TotalAmount2" type="text" name="required" required="true" />
                                            </div>
                                        </div>
                                        <label class="col-sm-2 col-form-label">Add Documentation</label>
                                        <div class="col-sm-4">
                                            <div class="form-group">

                                                <div class="form-group form-file-upload form-file-multiple">
                                                    <input type="file" id="Documentation2" name="Documentation2" multiple="" class="inputFileHidden">
                                                    <input type="text" class="form-control inputFileVisible" placeholder="Please Select Project Documentation" multiple="">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 col-form-label">Project Status</label>
                                        <div class="col-sm-4">
                                            <div class="form-group">

                                                <select id="ProjectStatus2" class="form-control sn-required2">
                                                    <option value="Pending">select Status</option>
                                                    <option value="Pending">Pending</option>
                                                    <option value="Working">Working</option>
                                                    <option value="Completed">Completed</option>
                                                    <option value="Delivered">Delivered</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer text-center">

                                    <button type="button" class="btn btn-primary" id="btnSubmit2">Submit</button>

                                </div>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $('#State1').change(function () {
        $.ajax({
            url: '/Employee/City',
            datatype: 'json',
            data: { StateId: $(this).val() },
            method: 'Post',
            success: function (data) {
                $('#City1').empty();
                $('#City1').append('<option value=""> Select City </option>');
                $(data).each(function (index, item) {
                    $('#City1').append($('<option/>', { Value: item.Value, text: item.Text }))
                });
            }
        });
    });
    $("#btnSubmit1").click(function () {
        $.ajaxSetup({
            beforeSend: function () {
                $(".processing").show();
            },
            complete: function () {
                $(".processing").hide();
            }
        });
        var flag = 0;
        var cntrl;
        $('input.sn-required1,select.sn-required1,textarea.sn-required1').each(function () {
            cntrl = $(this);
            if (cntrl.val().toString().length == 0) {
                flag = 1;
                if (!cntrl.hasClass('sn-error'))
                    cntrl.removeClass('border-success');
                cntrl.addClass('sn-error');
                swal.fire({
                    title: "Error",
                    text: "Something is missing",
                    icon: "error",
                    timer: 6000,
                });
            }
            else {
                if (cntrl.hasClass('sn-error')) cntrl.removeClass('sn-error');
            }
        });
        if (flag == 1) return;
        var client = {
            Id: $("#Id").val(),
            CompanyName: $("#CompanyName1").val(),
            ContactPerson: $("#ContactPerson1").val(),
            ContactNo: $("#ContactNo1").val(),
            GSTNo: $("#GSTNo1").val(),
            State: $("#State1").val(),
            City: $("#City1").val(),
            StateName: $("#State1").find("option:selected").text(),
            CityName: $("#City1").find("option:selected").text(),
            Address: $("#Address1").val(),
            Statecode: $("#Statecode1").val(),
            Pincode: $("#Pincode1").val(),
            PanNo: $("#PanNo1").val(),
            EmailId: $("#EmailId1").val(),
            Designation: $("#Designation1").val(),
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            data: client,
            url: "/Admin/InsertClient",
            Contenttype: "application/json; charset=utf-8",
            success: function (message) {
                if (message == "success") {
                    swal.fire({
                        title: "Success",
                        text: "Successfully Added!",
                        icon: "success",
                        timer: 6000,
                    });
                    window.location.href = "/Admin/GenrateQuatation";
                }
                else {
                    swal.fire({
                        title: "Error",
                        text: "Something Wrong!",
                        icon: "error",
                        timer: 6000,
                    });
                }

            }
        });
    });
    $('#CompanyName2').change(function () {
        var me = $(this);
        $.ajaxSetup({
            beforeSend: function () {
                $(".processing").show();
                me.attr('disabled', 'disabled');
            },
            complete: function () {
                $(".processing").hide();
                me.attr('disabled', false);
            }
        });
        var ClientId = {
            ClientId: $(this).val()
        }
        $.ajax({
            type: "POST",
            url: "/Admin/GetCompanyDetail",
            data: JSON.stringify(ClientId),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (resultData) {
                if (resultData != null) {

                    $('#Company2').text(resultData.CompanyName);
                    $('#ContectPerson2').text(resultData.ContactPerson);
                    $('#Mobile2').text(resultData.ContactNo);
                    $('#Gst2').text(resultData.GSTNo);
                    $('#EmailId2').text(resultData.EmailId);
                    $('#StateName2').text(resultData.StateName);
                    $('#CityName2').text(resultData.CityName);
                    $("#ClientName2").val(resultData.ContactPerson);
                    $("#Clients2").show();

                }
            }
        });

    });
    $("#btnSubmit2").click(function () {
        $.ajaxSetup({
            beforeSend: function () {
                $(".processing").show();
            },
            complete: function () {
                $(".processing").hide();
            }
        });
        var flag = 0;
        var cntrl;
        $('input.sn-required2,select.sn-required2,textarea.sn-required2').each(function () {
            cntrl = $(this);
            if (cntrl.val().toString().length == 0) {
                flag = 1;
                if (!cntrl.hasClass('sn-error'))
                    cntrl.removeClass('border-success');
                cntrl.addClass('sn-error');
                swal.fire({
                    title: "Error",
                    text: "Something is missing",
                    icon: "error",
                    timer: 6000,
                });
            }
            else {
                if (cntrl.hasClass('sn-error')) cntrl.removeClass('sn-error');
            }
        });
        // var EmployeeId = []
        //// var EmployeeName = []
        // $("#EmployeeName :selected").map(function (i, el) {
        //     var emp = $(el).val();
        //    // var emname = $(el).find("option:selected").text()
        //     EmployeeId.push(emp)
        //    // EmployeeName.push(emname)

        // });
        if (flag == 1) return;
        if (window.FormData !== undefined) {
            //var fileUpload = $("#Documentation").get(0);
            //var files = fileUpload.files;

            // Create FormData object
            var fileData = new FormData();

            // Looping over all files and add it to FormData object
            var totalFiles = document.getElementById("Documentation2").files.length;
            for (var i = 0; i < totalFiles; i++) {
                var file = document.getElementById("Documentation2").files[i];
                fileData.append("Documentation2", file);
            }
        }
        fileData.append("Id", $("#Id").val()),
            fileData.append("CompanyId", $("#CompanyName2").val()),
            fileData.append("CompanyName", $('#CompanyName2').find("option:selected").text()),
            fileData.append("ClientName", $("#ClientName2").val()),
            fileData.append("ProjectName", $("#ProjectName2").val()),
            fileData.append("ProjectStartingDate", $("#ProjectStartingDate2").val()),
            fileData.append("CompletionDate", $("#CompletionDate2").val()),
            fileData.append("ProjectDeliveryDate", $("#ProjectDeliveryDate2").val()),
            fileData.append("TotalAmount", $("#TotalAmount2").val()),
            fileData.append("ProjectStatus", $("#ProjectStatus2").val()),
            fileData.append("ProjectCode", $("#ProjectCode2").val()),
            $.ajax
                ({
                    type: "Post",
                    url: "/Admin/InsertProject",
                    data: fileData,
                    contentType: false,
                    dataType: "json",
                    processData: false,
                    success: function (message) {
                        if (message == "success") {
                            swal.fire({
                                title: "Success",
                                text: "Successfully Added!",
                                icon: "success",
                                timer: 6000,
                            });
                            window.location.href = "/Admin/GenrateQuatation";
                        }
                        else {
                            swal.fire({
                                title: "Error",
                                text: "Something Wrong!",
                                icon: "error",
                                timer: 6000,
                            });
                        }

                    }
                });
    });
</script>


