
@{
    ViewBag.Title = "selectTaskViewById";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="row mb-2">
    <div class="col-sm-12">
        <h4 class="m-0" style="text-align: center; background: rgba(22,160,133,0.9);color:white;font-weight:bold">Task</h4>
    </div><!-- /.col -->
    <!-- /.col -->
</div>

<section class="content">
    <div class="container-fluid">

        <section class="content">
            <table class="table">
                <tr>
                    <th>Assigned Employee</th>
                    <td>@Model.assigned_emp</td>
                    <th>Task Title</th>
                    <td>@Model.title</td>

                </tr>

                <tr>
                    <th>Assigned Date</th>
                    <td>@Model.current_date</td>
                    <th>Completion Date</th>
                    <td>@Model.complete_date</td>

                </tr>

                <tr>
                    <th>Task Status</th>
                    <td>
                        @{ var status = @Html.Raw(Model.task_status).ToString(); }

                        @if (status == "Closed")
                        {
                            <span class="badge badge-success">@Html.Raw(Model.task_status)</span>
                        }
                        else if (status == "Pending")
                        {
                            <span class="badge badge-warning">@Html.Raw(Model.task_status)</span>
                        }
                        else if (status == "Not Responding")
                        {
                            <span class="badge badge-danger">@Html.Raw(Model.task_status)</span>
                        }
                    </td>

                    <th>Employee Status</th>
                    <td>
                        @{ var emp_status = @Html.Raw(Model.emp_status).ToString(); }

                        @if (emp_status == "Complete")
                        {
                            <span class="badge badge-success">@Html.Raw(Model.emp_status)</span>
                        }
                        else if (emp_status == "Pending")
                        {
                            <span class="badge badge-warning">@Html.Raw(Model.emp_status)</span>
                        }
                        else if (emp_status == "Not Complete")
                        {
                            <span class="badge badge-danger">@Html.Raw(Model.emp_status)</span>
                        }
                    </td>


                </tr>

                <tr>
                    <th>Employee Updated Date</th>
                    <td>@Model.updatedDateEmp</td>
                </tr>

                <tr>
                    <th>Description</th>
                    <td style=" width: 400px;">@Model.description</td>
                </tr>

                <tr>
                    <th>Comments By Employee</th>
                    <td style=" width: 400px;">@Model.commentTask</td>
                </tr>

                <tr>
                    @if (Model.attachment1 != null && Model.attachment1 != "")
                    {
                        <th>Attachment 1</th>
                        <td><img src="@Model.attachment1" style="width:250px;" /></td>
                    }
                    @if (Model.attachment2 != null && Model.attachment2 != "")
                    {
                        <th>Attachment 2</th>
                        <td><img src="@Model.attachment2" style="width:250px;" /></td>
                    }
                    @if (Model.attachment3 != null && Model.attachment3 != "")
                    {
                        <th>Attachment 3</th>
                        <td><img src="@Model.attachment3" style="width:250px;" /></td>
                    }
                    @if (Model.attachment4 != null && Model.attachment4 != "")
                    {
                        <th>Attachment 4</th>
                        <td><img src="@Model.attachment4" style="width:250px;" /></td>
                    }
                    @if (Model.attachment5 != null && Model.attachment5 != "")
                    {
                        <th>Attachment 5</th>
                        <td><img src="@Model.attachment5" style="width:250px;" /></td>
                    }
                </tr>



                @*<tr>
                <th>Remark</th>
                <td><textarea id="remark"></textarea></td>
            </tr>


            <tr>
                <th><button>Approve</button> </th>
                <td>@Model.reason</td>
            </tr>*@
            </table>
            <form>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label>Comment Regarding this task(If Any)</label>
                        <input type="text" class="form-control" id="commentTask" name="commentTask" placeholder="Enter any Comments">
                    </div>
                </div>
                <div class="form_button_box">
                    <button type="submit" id="approve_btn" class="btn btn-primary">Submit</button>
                </div>
                <input type="hidden" name="id" id="id"/>
            </form>
        </section>
        
    </div>
</section>
<script src="~/assets/js/jquery-ui.js"></script>
<script>


    $("#approve_btn").click(function () {

        //var id = $('#id').val();

        //var check = "In-Complete";

        //if ($('#checked').prop('checked')) {
        //    check = "Complete";
        //}


        Swal.fire({
            title: 'Please wait!',
            html: 'Data Added Successfully',
            timer: 700,
            allowOutsideClick: false,
            allowEscapeKey: false,
            allowEnterKey: false,
            didOpen: () => {
                Swal.showLoading()
            },
            willClose: () => {
                clearInterval(timerInterval)
            }
        });

        var formdata = new FormData();

        formdata.append("id", $('#id').val());
        formdata.append("commentByOther", $('#commentTask').val());
    
        $.ajax({
            type: "POST",
            url: "/admin/Add_Comment",
            data: formdata,
            dataType: "json",
            contentType: false,
            processData: false,
            success: function (data, textStatus, xhr) {
                console.log(data);
                if (data.success == true) {
                    Swal.fire({
                        icon: 'success',
                        html: '<p style="font-size: 17px;">Add Successfully</p>',
                        returnFocus: true,
                    }).then((data) => {
                        if (data.isConfirmed) {
                            window.location.href = data.redirectUrl; // Use the redirect URL from the server response
                        }
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        html: '<p style="font-size: 17px;">' + data.message + '</p>',
                    });
                }
            },
            //error: function (xhr, textStatus, errorThrown) {
            //    Swal.fire({
            //        icon: 'error',
            //        html: '<p style="font-size: 17px;">An Error Occured try again later or contact website administration.</p>',
            //        returnFocus: true,
            //        returnFocus: false,
            //    }).then((result) => {
            //        if (result.isConfirmed) {

            //            return false;
            //        }
            //    })

            //},
            complete: function () {
            }
        });

        return false;

    });
</script>

<script type="text/javascript">

    @if(TempData["Message"] != null) {<text >
            $(window).load(function()
                {
                $(document).ready(function()
                {
                    var tt = @TempData["para"];
                    if (tt == true) {
                        Swal.fire({
                            icon: 'success',
                            title: "Success",
                            text: "@TempData["Message"]",
                        });
                    }
                      else{
                        Swal.fire({
                            icon: 'error',
                            title: "Success",
                            text: "@TempData["Message"]",
                        });
                    }
                });
            }); </text>
    }
</script>

@*<section class="content">
        <div class="container-fluid">

            <section class="content">

                <form>
                    <div class="form-row">
                        <div class="form-group col-md-10">
                            <label for="" class="heading">Mark To Complete This Task:-</label>
                            <input type="checkbox" name="checked" id="checked" />
                        </div>

                    </div>
                    <input type="hidden" name="id" id="id" value="@Model.id" />
                    <div class="form-row form_button_box" style=" TEXT-ALIGN: center;">

                        <div class="form-group col-md-6">
                            <input type="button" class="btn btn-success update_btn" id="approve_btn" value="Update">
                        </div>



                    </div>
                </form>

            </section>
        </div>
    </section>*@


<script src="https://localhost:44373/assets/Plugins/jquery/jquery.min.js"></script>









