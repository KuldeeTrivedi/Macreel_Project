
@{
    ViewBag.Title = "AddPayment";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    * {
        box-sizing: border-box;
    }

    .Description {
        transition: transform .2s;
        margin: 0 auto;
    }

        .Description:hover {
            -ms-transform: scale(1.9); /* IE 9 */
            -webkit-transform: scale(1.9); /* Safari 3-8 */
            transform: scale(1.9);
        }

    .col-form-label {
        font-size: 10px;
        font-weight: 500;
    }

    .h5 {
        text-align: center;
        background-color: #1d3c60;
        color: white;
    }

    .font {
        font-size: 11px;
        font-weight: 700 !important;
        background: #112d4f;
        color: #fff;
    }

    .edit-box h5 {
        font-size: 19px;
        text-align: center;
    }

    .edit-box {
        padding: 25px 0px;
    }

    .col-form-label {
        font-size: 10px;
        font-weight: 500;
    }

    .h5 {
        text-align: center;
        background-color: #1d3c60;
        color: white;
    }

    .head-title th {
        font-size: !important;
        font-size: 14px !important;
        color: #fff;
        padding: 9px !IMPORTANT;
        font-weight: 700 !IMPORTANT;
    }

    .bg-info {
        background-color: #1a385b !important;
        /* padding: 6px !IMPORTANT; */
    }

    .table-bg {
        border: 1px solid #1a385b;
        margin-bottom: 30px;
    }

    .processing {
        position: fixed;
        z-index: 10000;
        height: 100%;
        width: 100%;
        top: 0;
        left: 0;
        background-color: Black;
        filter: alpha(opacity=60);
        opacity: 0.6;
        -moz-opacity: 0.8;
    }

    .center {
        z-index: 10000;
        margin: 300px auto;
        padding: 10px;
        width: 130px;
        background-color: White;
        border-radius: 10px;
        filter: alpha(opacity=100);
        opacity: 1;
        -moz-opacity: 1;
    }

    .sn-error {
        border-color: red;
    }
</style>
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-12">
                <h1 class="m-0">ADD PAYMENT</h1>
            </div><!-- /.col -->
            <!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<div class="processing" style="display: none">
    <div class="center">
        <span style="color:red;"><i style="font-size:14pt; font-weight:bold; opacity:1!important; margin-top:4px;" class="fa fa-spin fa-spinner"></i> Processing...</span>
    </div>
</div>
<div class="panel-header panel-header-sm">
</div>
<div class="content">
    <div class="row">
        <div class="col-md-12">
            <form id="TypeValidation" class="form-horizontal">
                <div class="card ">
                  
                    <div class="card-body ">
                        <div class="row">
                            
                            <div class="col-md-2">
                                <label for="companyname">Company Name</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <select id="CompanyName" class="form-control sn-required">
                                        <option>--Select Client--</option>
                                        @if (ViewBag.client != null)
                                        {
                                            foreach (var item in ViewBag.client as List<SelectListItem>)
                                            {

                                                <option value="@item.Value">@item.Text</option>

                                            }
                                        }
                                    </select>

                                </div>
                            </div>
                           
                            <div class="col-md-2">
                                <label for="companyname">Total Amount</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <input class="form-control sn-required" readonly id="TotalPayment" placeholder="Total Amount" type="text" name="required" required="true" />
                                </div>
                            </div>
                        </div>
                        <div class="row">

                            <div class="col-md-2">
                                <label for="companyname">Remaining Amount</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <input class="form-control sn-required" id="totalRemainAmount" placeholder="Remaining Amount" type="text" name="required" required="true" />
                                </div>
                            </div>
                            
                            <div class="col-md-2">
                                <label for="companyname">Pay Amount</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <input class="form-control sn-required" id="Payamount" placeholder="Enter Pay Amount" type="text" name="required" required="true" />
                                </div>
                            </div>
                        </div>
                        <div class="row">

                            <div class="col-md-2">
                                <label for="companyname">Remain Amount</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <input class="form-control sn-required" id="RemainAmount" placeholder="Remain Amount" type="text" name="required" required="true" />
                                </div>
                            </div>
                           
                            <div class="col-md-2">
                                <label for="companyname">Payment Mode</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <select id="PaymentMode" class="form-control sn-required">

                                        <option value="">Select </option>
                                        <option value="chequeNo">Cheque</option>
                                        <option value="NEFT">NEFT</option>
                                        <option value="Direct">Direct</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">

                            <div class="col-md-2">
                                <label for="companyname">Date</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <input class="form-control sn-required datepicker" id="duedate" value="@System.DateTime.Now.ToString("dd-MM-yyyy")" placeholder="dd-mm-yyyy" type="text" name="required" required="true" />
                                </div>
                            </div>
                           
                            <div class="col-md-2">
                                <label for="companyname">Remark</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group sn-required">
                                    <textarea style="width: 100%;" class="sn-required" id="Remark"></textarea>
                                </div>
                            </div>
                        </div>
                        <div id="ShowBankdetails">
                            <div class="row">

                                <div class="col-md-2">
                                    <label for="companyname">Bank Name</label>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <input class="form-control" id="BankName" placeholder="Enter Bank Name" type="text" name="required" required="true" />
                                    </div>
                                </div>
                               
                                <div class="col-md-2">
                                    <label for="companyname">Cheque No</label>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <input class="form-control" id="Cheque" placeholder="Cheque No" type="text" name="required" required="true" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">

                                <div class="col-md-2">
                                    <label for="companyname">Branch Name</label>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <input class="form-control" id="Branch" placeholder="Branch Name" type="text" name="required" required="true" />
                                    </div>
                                </div>
                               
                                <div class="col-md-2">
                                    <label for="companyname">Cheque Date</label>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <input class="form-control datepicker" id="chequedate" placeholder="Cheque Date" type="text" name="required" required="true" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="HideUTr">
                            <div class="row">

                               
                                <div class="col-md-2">
                                    <label for="companyname">UTR NO</label>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <input class="form-control" id="UTRNo" placeholder="Enter UTRNo" type="text" name="required" required="true" />
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="card-footer text-center">

                        <button type="button" class="btn btn-primary" id="btnSave">Pay</button>


                    </div>
                </div>
            </form>
        </div>

    </div>
</div>
<script src="~/scripts/jquery-3.4.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" defer></script>
<script src="~/scripts/alert.js" defer></script>
<script>
    //$('#CompanyName').change(function () {
    //    $.ajax({
    //        url: '/Admin/BindProjectForQuatation',
    //        datatype: 'json',
    //        data: { CompanyId: $(this).val() },
    //        method: 'Post',
    //        success: function (data) {
    //            $('#ProjectName').empty();
    //            $('#ProjectName').append('<option value="">Select Project</option>');
    //            $(data).each(function (index, item) {
    //                $('#ProjectName').append($('<option/>', { Value: item.Value, text: item.Text }))
    //            });
    //        }
    //    })
    //});
    $(function () {
        $(".datepicker").datepicker({
            dateFormat: 'dd-mm-yy',
            changeMonth: true,
            changeYear: true,
            yearRange: "c-100:c+100",
        });
    });
    $(document).ready(function () {
        $('#CompanyName').change(function () {
            $.ajaxSetup({
                beforeSend: function () {
                    $(".processing").show();
                },
                complete: function () {
                    $(".processing").hide();
                }
            });
            $.ajax({
                type: "POST",
                async: true,
                url: "/Admin/GetPaymentorPayment",
                data: {CompanyId: $("#CompanyName").val() },
                success: function (resultData) {
                    $('#TotalPayment').val(resultData.TotalAmount);
                    if (resultData.TotalAmount != 0 && resultData.RemainingAmount == 0.00) {
                        swal.fire({
                            title: "success",
                            text: "Paymet is Completed!",
                            timer: 8000,
                            icon: "success"
                        });
                        $('#totalRemainAmount').val(resultData.RemainingAmount);
                        $('#totalRemainAmount').attr('disabled', true);
                        $('#RemainAmount').attr('disabled', false);
                        $('#Payamount').attr('disabled', true);
                    }
                    else if (resultData.TotalAmount != 0 && resultData.RemainingAmount == "")
                    {
                        $('#totalRemainAmount').val(resultData.TotalAmount);
                        $('#totalRemainAmount').attr('disabled', true);
                        $('#RemainAmount').attr('disabled', false);
                        $('#Payamount').attr('disabled', false);
                    }
                    else
                    {
                        $('#totalRemainAmount').val(resultData.RemainingAmount);
                        $('#totalRemainAmount').attr('disabled', true);
                        $('#RemainAmount').attr('disabled', false);
                        $('#Payamount').attr('disabled', false);
                    }
                }
            });
        })
        $('#Payamount').keyup(function () {
            var payment = parseInt($(this).val());
            var totalremain = $("#totalRemainAmount").val();
            $("#RemainAmount").val(totalremain - payment);
        });
        $("#ShowBankdetails").hide();
        $("#HideUTr").hide();
        $("#PaymentMode").change(function () {
            if($(this).val()=="chequeNo")
            {
                $("#ShowBankdetails").show();
            }
            else if($(this).val()=="NEFT")
            {
                $("#HideUTr").show();
                $("#ShowBankdetails").hide();
            }
            else {
                $("#HideUTr").hide();
                $("#ShowBankdetails").hide();
            }
        });
        $('#btnSave').click(function () {
            var me = $(this);
            $.ajaxSetup({
                beforeSend: function () {
                    $(".processing").show();
                    me.attr('disabled', 'disabled');
                },
                complete: function () {
                    $(".processing").hide();
                    $('#Password').val('');
                    me.attr('disabled', false);
                }
            });
            var flag = 0;
            var cntrl;
            $('input.sn-required,select.sn-required,textarea.sn-required').each(function () {
                cntrl = $(this);
                if (cntrl.val().toString().length == 0) {
                    flag = 1;
                    if (!cntrl.hasClass('sn-error'))
                        cntrl.removeClass('border-success')
                    cntrl.addClass('sn-error');
                    swal.fire({
                        title: "Error",
                        text: "Something Is Missing",
                        timer: 8000,
                        icon: "error"
                    });
                }
                else {
                    if (cntrl.hasClass('sn-error')) cntrl.removeClass('sn-error');
                    cntrl.addClass('border-success')
                }
            });
            if (flag == 1) return;
            var Product = {
                CompanyId: $("#CompanyName").val(),
                CompanyName: $("#CompanyName").find("option:selected").text(),
                //ProjectId: $("#ProjectName").val(),
                //ProjectName: $("#ProjectName").find("option:selected").text(),
                TotalAmount: $('#TotalPayment').val(),
                Payment: $('#Payamount').val(),
                RemainingAmount: $('#RemainAmount').val(),
                PaymentMode: $('#PaymentMode').val(),
                BankName: $('#BankName').val(),
                Branch: $('#Branch').val(),
                ChequeNo: $('#Cheque').val(),
                chequeDate: $('#chequedate').val(),
                UTRNO: $('#UTRNo').val(),
                Remark: $('#Remark').val(),
                Date: $("#duedate").val(),
            };
            $.ajax({
                type: "POST",
                url: "/Admin/InsertPayment",
                data: JSON.stringify(Product),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (resultData) {
                    if (resultData.split(',')[1]!="success")
                        MsgBox(resultData.split(',')[0], resultData.split(',')[1]);

                    else {
                        MsgBoxRedirect(resultData.split(',')[0], resultData.split(',')[1], '/Admin/AddPayment');
                    }
                }
            });
        });
    })
    function MsgBox(message, atype) {
        $.alert(message, { title: '', type: atype, autoClose: true, closeTime: 105000, minTop: 100 });

    }
    function MsgBoxRedirect(message, atype, location) {
        $.alert(message, { title: '', type: atype, autoClose: true, closeTime: 1000, minTop: 100, onClose: function () { window.location = location; } });
    }
</script>






